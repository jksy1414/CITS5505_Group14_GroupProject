{% extends "based.html" %}

{% block styles %}
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style_output.css') }}">
{% endblock %}

{% block content %}
<div class="container">
  <h2>Fitness Data Chart</h2>

  <p><strong>Current Sharing Option:</strong> {{ visibility|capitalize }}</p>

  <!-- Chart type selector -->
  <label for="chartType">Select Chart Type:</label><br>
  <select id="chartType" onchange="renderChart()">
    <option value="line">Line Chart</option>
    <option value="bar">Bar Chart</option>
  </select><br><br>

  <!-- Chart canvas -->
  <canvas id="fitnessChart" style="width:100%; max-width:600px; margin:auto;"></canvas><br>

  <!-- Action buttons -->
  <button class="btn" onclick="downloadChart()">Download Graph</button>

  <!-- Sharing Option Form -->
  <form method="POST" action="{{ url_for('set_visibility') }}" style="margin-top: 20px;">
    <label for="visibility">Change Sharing Option:</label>
    <select name="visibility">
      <option value="private">Private (Only Me)</option>
      <option value="public">Public (Everyone)</option>
      <option value="friends">Friends Only</option>
    </select>
    <button type="submit" class="btn">Save Sharing Setting</button>
  </form>
</div>

<!-- Chart.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const labels = {{ labels|tojson }};
  const values = {{ values|tojson }};
  const columnName = "{{ column_name }}";

  let chart;

  function renderChart() {
    const chartType = document.getElementById('chartType').value;
    const ctx = document.getElementById('fitnessChart').getContext('2d');

    if (chart) {
      chart.destroy();
    }

    chart = new Chart(ctx, {
      type: chartType,
      data: {
        labels: labels,
        datasets: [{
          label: columnName,
          data: values,
          borderWidth: 2,
          fill: false,
          borderColor: 'rgba(75, 192, 192, 1)',
          backgroundColor: 'rgba(75, 192, 192, 0.2)'
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { display: true }
        },
        scales: {
          y: { beginAtZero: true }
        }
      }
    });
  }

  document.addEventListener("DOMContentLoaded", renderChart);
</script>
{% endblock %}
